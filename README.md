<p align="center">
  <img src="https://github.com/user-attachments/assets/1e156ecb-75d5-4004-b768-cbd8edab7940" width="300">
</p>

<!-- ![sb_logo](https://github.com/user-attachments/assets/6c5d9280-70b2-4f66-8bfb-c513317aea06) -->

# Spaceborne

---

[![Documentation Status](https://readthedocs.org/projects/spaceborne/badge/?version=latest)](https://spaceborne.readthedocs.io/en/latest/?badge=latest)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](./LICENSE)

## Installation

For detailed instructions on how to install and use Spaceborne, please refer to the official [documentation](https://spaceborne.readthedocs.io/en/latest/).

### TL;DR

```bash
# clone the repository
git clone https://github.com/davidesciotti/Spaceborne.git

# checkout the latest release (version tag); e.g., git checkout v2025.07.1
git checkout <latest_version_tag>

# enter the Spaceborne root directory you just cloned
cd Spaceborne

# create the conda environment (mainly needed to install PyCCL and NaMaster through conda-forge)
# This step can be slow; add --solver=libmamba to speed it up (see below for more details)
conda env create -f environment.yaml

# activate the newly created Conda environment
conda activate spaceborne

# Install juliaup
curl -fsSL https://install.julialang.org | sh

# Install Julia version 1.10
juliaup default 1.10

# install required Julia packages
julia -e 'using Pkg; Pkg.add("LoopVectorization"); Pkg.add("YAML"); Pkg.add("NPZ")'

# Finally, install pip dependencies and Spaceborne itself
pip install .
```

### Some notes

‚ùó The only stable versions you should consider are the code releases. Please avoid simply cloning and installing the code from the main branch.
**As the code is evolving quite quickly at the moment, please make sure to check for new [releases](https://github.com/davidesciotti/Spaceborne/releases) periodically**
Moreover, installation is only supported in a dedicated Conda environment, for the time being (installation via PyPI is work in progress).

üêç To significantly speed up the environment creation, install `mamba` by running `conda install mamba` in your `base` environment., then do

```bash
mamba env create -f environment.yaml  # or
conda env create -f environment.yaml --solver=libmamba # instead of
conda env create -f environment.yaml
```

üü£ Spaceborne leverages `Julia` for computationally intensive tasks. We recommend installing `Julia` via [`juliaup`](https://github.com/JuliaLang/juliaup) as indicated above

## Running the Code

All the available options and configurations can be found, along with their explanation, in the `config.yaml` file. To run `Spaceborne` _with the configuration specified in the_ `Spaceborne/config.yaml` _file_, simply execute the following command:

```bash
python main.py
```

If you want to use a configuration file with a different name and/or location, you can instead run with

```bash
python main.py --config=<path_to_config_file>
```

for example:

```bash
python main.py --config="path/to/my/config/config.yaml"
```

To display the plots generated by the code, add the `--show-plots` flag:

```bash
python main.py --config="path/to/my/config/config.yaml" --show-plots
```

Additionally, in the `config.yaml` file you can set `save_figs: True` to save the figures in the `<output_folder>/figs` path.

## Using Docker üêã

If you find issues with the installation, you can happily disregard the above instructions and run the code through Docker. To do this, install [Docker Desktop](https://www.docker.com/products/docker-desktop/) or the [Docker engine](https://docs.docker.com/engine/); then, in the root of the cloned repository (again, remember to checkout the latest release), run:

```bash
docker-compose up --build
```

Note that the `--build` flag is only needed the first time you run the code (or if you modify the `environment.yaml` or `Dockerfile`, which is **highly discouraged**). For subsequent runs, simply do:

```bash
docker-compose up
```

Finally, to stop the container, do

```bash
docker-compose down
```

That's it! The container will use your local `config.yaml` file and output to the directories specified in your configuration, just as if you were running locally.

---
